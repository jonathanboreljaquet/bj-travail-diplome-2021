<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href='fullcalendar/lib/main.css' rel='stylesheet' />
    <link href='bootstrap/css/bootstrap.css' rel='stylesheet' />
    <link href='fontawesome/css/all.css' rel='stylesheet' />
    <link href='css/modal.css' rel='stylesheet' />

    <script src='jquery/jquery-3.6.0.js'></script>
    <script src='bootstrap/js/bootstrap.js'></script>
    <script src='fullcalendar/lib/main.js'></script>
    <script src='fullcalendar/lib/locales/fr.js'></script>
    <title>Document</title>
</head>

<body>
    <div class="container">
        <select name="users" id="users_menu">
            <option value="1">Boris</option>
            <option value="2">Simon</option>
            <option value="3">Aurel</option>
            <option value="4">Samanthan</option>
          </select>
        <div id='calendar'></div>


        <!-- Button to Open the Modal -->
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal">
          Open modal
        </button>

        <!-- The Modal -->
        <div class="modal" id="myModal">
            <div class="modal-dialog">
                <div class="modal-content">

                    <!-- Modal Header -->
                    <div class="modal-header">
                        <h4 class="modal-title">Modal Heading</h4>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>

                    <!-- Modal body -->
                    <div class="modal-body">
                        Modal body..
                    </div>

                    <!-- Modal footer -->
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                    </div>

                </div>
            </div>
        </div>

    </div>
</body>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            locale: 'fr',
            allDaySlot: false,
            headerToolbar: {
              left: 'prev,next today',
              center: 'title',
              right: 'dayGridMonth,timeGridWeek,timeGridDay'
            },
            height: 850,
            initialView: $(window).width() < 765 ? 'timeGridDay' : 'timeGridWeek',
            themeSystem: 'bootstrap',
            windowResize: function(view) {
                if ($(window).width() < 514) {
                    calendar.changeView('timeGridDay');
                    calendar.setOption('height', 700);
                } else {
                    calendar.changeView('timeGridWeek');
                }
            },
            events: function(info, successCallback, failureCallback) {
                $.ajax({
                    url: "https://api-rest-douceur-de-chien.boreljaquet.ch/plannings/1",
                    type: 'GET',
                    dataType: 'json',
                    success: function(data) {
                        var events = [];
                        $.each(data, function(index) {
                            events.push({
                                "title": "Libre",
                                "start": data[index].date + " " + data[index].time_start,
                                "end": data[index].date + " " + data[index].time_end

                            });
                        });
                        successCallback(events);
                    },
                    error: function() {
                        failureCallback("failed")
                    },
                });
            },
            eventClick: function(info) {
                calendar.gotoDate(info.event.endStr);
                calendar.changeView('timeGridDay');
            }
        });

        calendar.render();

        $('#users_menu').change(function() {

            $.ajax({
                url: "https://api-rest-douceur-de-chien.boreljaquet.ch/plannings/" + $(this).val(),
                type: 'GET',
                dataType: 'json',
                success: function(data) {
                    var events = [];
                    $.each(data, function(index) {
                        events.push({
                            "title": "Libre",
                            "start": data[index].date + " " + data[index].time_start,
                            "end": data[index].date + " " + data[index].time_end

                        });
                    });
                    var oldEvents = calendar.getEventSources();
                    oldEvents[0].remove()
                    calendar.addEventSource(events);
                },
                error: function() {
                    failureCallback("failed")
                },
            });
        });
    });
</script>

</html>

</html>